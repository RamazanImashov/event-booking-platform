## Документация для проекта "Event Booking Platform"

### 1. Общая информация о проекте

**Название проекта:** Event Booking Platform

**Цель проекта:**
Создание платформы для организации и бронирования мероприятий, где пользователи могут создавать события, просматривать их, а также бронировать билеты. Платформа поддерживает регистрацию, управление ролями (организаторы, участники), и уведомления о предстоящих мероприятиях и изменениях.

**Описание функциональности:**
Проект предназначен для изучения микросервисной архитектуры и применения современных технологий для обеспечения независимости и масштабируемости каждого сервиса. Основные возможности:
- Регистрация и аутентификация пользователей с разграничением ролей.
- Создание, редактирование и удаление мероприятий организаторами.
- Бронирование мест на мероприятиях.
- Отправка уведомлений участникам о бронированиях и изменениях событий.

---

### 2. Архитектура проекта

Проект разделен на несколько микросервисов, взаимодействующих через **gRPC** и **REST API** для максимальной производительности и безопасности.

#### 2.1. Микросервис пользователей
- **Фреймворк:** Django REST Framework (DRF)
- **Функциональность:**
  - Регистрация и аутентификация пользователей, включая подтверждение по email или SMS.
  - Управление профилем пользователя и правами доступа (организатор, участник, администратор).
  - Поддержка OAuth для регистрации через социальные сети.
  - Хранение данных пользователей в базе данных PostgreSQL.

#### 2.2. Микросервис мероприятий
- **Фреймворк:** FastAPI
- **Функциональность:**
  - Создание, редактирование и удаление мероприятий организаторами.
  - Получение данных о пользователях из микросервиса пользователей через **gRPC**.
  - Хранение информации о мероприятиях, включая название, дату, место и доступные места.

#### 2.3. Микросервис бронирования
- **Фреймворк:** FastAPI
- **Функциональность:**
  - Обработка бронирований пользователей на мероприятия.
  - Проверка доступности мест и их резервирование.
  - Взаимодействие с микросервисами пользователей и мероприятий для подтверждения данных.
  - Хранение информации о бронированиях в базе данных PostgreSQL.

#### 2.4. Микросервис уведомлений
- **Фреймворк:** FastAPI
- **Функциональность:**
  - Асинхронная отправка уведомлений пользователям об успешных бронированиях, изменениях мероприятий и отменах.
  - Поддержка отправки уведомлений через email и SMS.
  - Использование **Celery** и **Redis** для очередей задач.

---

### 3. Используемые технологии и стек

- **Бэкенд:**
  - Django REST Framework для сервиса пользователей.
  - FastAPI для сервисов мероприятий, бронирования и уведомлений.
  - Celery и Redis для асинхронной обработки задач.
  - JWT для аутентификации.
  
- **Базы данных:**
  - PostgreSQL для хранения данных пользователей, мероприятий и бронирований.

- **Контейнеризация:**
  - Docker для контейнеризации всех сервисов.
  - Docker Compose для организации и развертывания проекта локально.

---

### 4. Основные пользовательские сценарии и API

#### 4.1. Пользовательский сценарий
1. **Регистрация:** Пользователь регистрируется на платформе, выбирает роль (организатор или участник), подтверждает аккаунт через email или SMS.
2. **Авторизация:** После регистрации пользователь авторизуется, получая JWT токен.
3. **Создание события:** Организатор создает мероприятие с указанием времени, места и других деталей.
4. **Бронирование:** Участник бронирует билет на мероприятие, доступность проверяется через сервис мероприятий.
5. **Уведомление:** Участники получают уведомления об успешном бронировании, а также любые изменения в мероприятии.

#### 4.2. API методы

##### Микросервис пользователей (DRF)
- `POST /register`: регистрация пользователя с подтверждением через email или SMS.
- `POST /login`: авторизация с выдачей JWT токена.
- `PUT /profile/update`: обновление профиля пользователя.
- **Swagger:** доступен для тестирования всех API.

##### Микросервис мероприятий (FastAPI)
- `POST /events`: создание нового мероприятия.
- `PUT /events/{event_id}`: редактирование мероприятия.
- `DELETE /events/{event_id}`: удаление мероприятия.
- `GET /events`: просмотр всех мероприятий.
- **Swagger:** доступен для тестирования API.

##### Микросервис бронирования (FastAPI)
- `POST /booking`: бронирование билета.
- `DELETE /booking/{booking_id}`: отмена бронирования.
- `GET /bookings`: просмотр всех бронирований.
- **Swagger:** доступен для тестирования API.

##### Микросервис уведомлений (FastAPI)
- `POST /notifications`: отправка уведомления.
- **Celery и Redis** обрабатывают отправку уведомлений через очереди задач.

---

### 5. Аутентификация и авторизация

- **Тип аутентификации:** JWT токены.
- **Подтверждение:** Код подтверждения по email или SMS.
- **Роли пользователей:** Администратор, организатор и участник, которые определяют доступ к действиям.

---

### 6. Логирование и мониторинг

- **Логирование:** Логирование событий и ошибок в каждом микросервисе с использованием встроенных инструментов Python.
- **Мониторинг:** Мониторинг и управление задачами Celery через Flower.

---

### 7. Развертывание и переменные окружения

#### Docker и Docker Compose
Проект развертывается через Docker Compose с конфигурацией для каждого микросервиса. Для каждого микросервиса предусмотрен свой Dockerfile.

#### Пример файла переменных окружения

Для Django сервиса
```env
SECRET_KEY=your-secret-key
DEBUG=True
DB_NAME=your-database-name
DB_HOST=database-host
DB_USER=database-user
DB_PASS=database-password
REDIS_HOST=redis-host

EMAIL_HOST_USER=your-email@example.com
EMAIL_HOST_PASSWORD=email-password
```

Для FastAPI сервисов
```env
SECRET_KEY=your-secret-key

DB_DRIVER=database-driver
DB_USER=database-user
DB_PASS=database-password
DB_HOST=database-host
DB_PORT=database-port
DB_NAME=database-name

GUNI_PORT=gunicorn_port

# BASE
API_V1_PREFIX="/api/v1"
DEBUG=True
PROJECT_NAME=project_name
VERSION=project_version
DESCRIPTION=project_description

# DATABASE
DB_ASYNC_CONNECTION_STR="database-driver+asyncpg://database-user:database-password@database-host:database-port/database-name"

APP_CONFIG__DB__URL=database-driver+asyncpg://database-user:database-password@database-host:database-port/database-name
APP_CONFIG__DB__ECHO=1
APP_CONFIG__GUNICORN__WORKERS=1

GRPC_SERVER=grpc-server-name
```

---

### Дополнительные сведения

1. **Масштабируемость:**
   - Платформа спроектирована с учетом горизонтального масштабирования, каждый микросервис можно развернуть на отдельных серверах.
2. **Дополнительные планы:**
   - Добавление интеграции с внешними платформами для уведомлений.
   - Логирование в централизованную систему для мониторинга и улучшения безопасности.

---

### Заключение
Проект **Event Booking Platform** реализован с использованием микросервисной архитектуры, что позволяет каждому сервису масштабироваться и обновляться независимо. Он поддерживает все основные функции для управления мероприятиями и бронирования билетов, делая систему удобной и быстрой для пользователей.
