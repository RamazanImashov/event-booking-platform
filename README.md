### **Обновленная архитектура Event Booking Platform**

#### Технологический стек

- **Auth-Service** (Django REST Framework)
- Остальные микросервисы (**FastAPI**)
- **RabbitMQ** (брокер сообщений) для асинхронного взаимодействия
- **API Gateway** на **FastAPI**
- **Docker** для контейнеризации
- **Kubernetes** для оркестрации (опционально, если требуется масштабируемость)

---

### **Микросервисы и их взаимодействие**

#### 1. **Auth-Service (Django REST Framework)**

   - **Описание**: Отвечает за регистрацию, аутентификацию и управление сессиями пользователей.
   - **Задачи**:
     - Регистрация новых пользователей
     - Аутентификация с использованием JWT
     - Публикация событий аутентификации и регистрации для других сервисов через брокер сообщений
   - **RabbitMQ очереди**:
     - `user_registered`: отправляет событие о новой регистрации.
   - **API**:
     - `POST /auth/register` — Регистрация пользователя.
     - `POST /auth/login` — Аутентификация.

#### 2. **Event-Service (FastAPI)**

   - **Описание**: Управляет событиями, их деталями и доступностью.
   - **Задачи**:
     - Создание, обновление и удаление событий
     - Публикация данных о создании и обновлении событий в брокер для других сервисов
   - **RabbitMQ очереди**:
     - `event_created`: содержит информацию о созданном мероприятии для других сервисов (например, бронирования и уведомлений).
   - **API**:
     - `POST /events/create` — Создание мероприятия.
     - `PUT /events/{event_id}/update` — Обновление информации о мероприятии.

#### 3. **Booking-Service (FastAPI)**

   - **Описание**: Управляет бронированиями билетов, проверяет доступность и создает бронирования.
   - **Задачи**:
     - Создание и управление бронированиями
     - Публикация событий бронирования для других сервисов (например, оплаты и уведомлений)
   - **RabbitMQ очереди**:
     - `booking_created`: отправляет информацию о новом бронировании для **Payment-Service**.
   - **API**:
     - `POST /booking/create` — Создание бронирования.

#### 4. **Payment-Service (FastAPI)**

   - **Описание**: Обрабатывает и подтверждает платежи.
   - **Задачи**:
     - Подтверждение и управление платежами
     - Публикация успешного платежа для **Notification-Service**
   - **RabbitMQ очереди**:
     - `payment_confirmed`: отправляет информацию о подтвержденных платежах для уведомлений и аналитики.
   - **API**:
     - `POST /payments/process` — Обработка платежа.

#### 5. **Notification-Service (FastAPI)**

   - **Описание**: Отправляет уведомления о различных событиях (бронирование, оплата).
   - **Задачи**:
     - Получение уведомлений от других сервисов и отправка пользователю по email, SMS или push
   - **RabbitMQ очереди**:
     - `notifications`: получает уведомления о событиях от других сервисов для отправки пользователям.
   - **API**:
     - `POST /notifications/send` — Отправка уведомлений.

#### 6. **Analytics-Service (FastAPI)**

   - **Описание**: Сбор аналитики о бронированиях, посещениях и оплатах.
   - **Задачи**:
     - Обработка и сбор аналитических данных от других сервисов
   - **RabbitMQ очереди**:
     - `analytics`: получает данные для сбора статистики о бронированиях и платежах.
   - **API**:
     - `GET /analytics/report` — Генерация отчета.

---

### **API Gateway**

API Gateway на **FastAPI** предоставляет единый вход для всех запросов и перенаправляет их к соответствующим сервисам. Gateway также может использоваться для аутентификации, чтобы проверить токены JWT перед отправкой запросов в **Auth-Service**.

- **Маршруты**:
  - `/auth/` → Auth-Service
  - `/events/` → Event-Service
  - `/booking/` → Booking-Service
  - `/payments/` → Payment-Service
  - `/notifications/` → Notification-Service
  - `/analytics/` → Analytics-Service

### **Использование RabbitMQ**

RabbitMQ используется для асинхронной передачи сообщений между сервисами, чтобы они могли взаимодействовать и обрабатывать события независимо.

#### Пример обмена сообщениями

- **Событие регистрации**: Auth-Service отправляет сообщение в очередь `user_registered`, и Notification-Service отправляет приветственное сообщение пользователю.
- **Событие бронирования**: Booking-Service отправляет сообщение в очередь `booking_created`, и Payment-Service начинает обработку платежа.
- **Событие оплаты**: Payment-Service отправляет сообщение в очередь `payment_confirmed`, и Notification-Service отправляет подтверждение пользователю, а также передает данные в Analytics-Service.

